(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-684fdd58"],{"07c8":function(e,t,r){},"5e66":function(e,t,r){"use strict";var a=r("07c8"),n=r.n(a);n.a},"93ad":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"strategy"},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("权限管理")]),r("el-breadcrumb-item",[e._v("策略管理")])],1),r("el-card",[r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:e.openAdd}},[e._v("添加策略")])],1),r("el-table",{attrs:{data:e.userList,stripe:"","row-key":e.getRowKeys,"expand-row-keys":e.expands},on:{"expand-change":e.expandChange}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.ruleItemData.length>0?r("el-row",e._l(t.row.ruleItemData,(function(a){return r("span",{key:a.apiId,staticStyle:{display:"inline-block",margin:"5px"}},[r("el-tag",{attrs:{closable:""},on:{close:function(r){return e.removeRightById(t.row,a.strategyActionId)}}},[e._v(e._s(a.apiName))])],1)})),0):r("el-row",[e._v(" 暂无配置操作 ")])]}}])}),r("el-table-column",{attrs:{type:"index",label:"序号"}}),r("el-table-column",{attrs:{label:"策略名称",prop:"strategyName","show-overflow-tooltip":!0}}),r("el-table-column",{attrs:{label:"描述",prop:"strategyDescribe","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(null===t.row.strategyDescribe||""===t.row.strategyDescribe?"-":t.row.strategyDescribe))])]}}])}),r("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}}),r("el-table-column",{attrs:{label:"操作",width:"280px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.editById(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.deleteById(t.row.strategyId)}}},[e._v("删除")]),r("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(r){return e.openAction(t.row)}}},[e._v("添加操作")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[5,10,15,20],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:e.title,visible:e.addFormDialogVisible,width:"500px"},on:{"update:visible":function(t){e.addFormDialogVisible=t},close:e.addDialogClosed}},[r("el-form",{ref:"addFormRef",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"策略名称",prop:"strategyName"}},[r("el-input",{attrs:{maxlength:"32","show-word-limit":""},model:{value:e.addForm.strategyName,callback:function(t){e.$set(e.addForm,"strategyName","string"===typeof t?t.trim():t)},expression:"addForm.strategyName"}})],1),r("el-form-item",{attrs:{label:"描述",prop:"strategyDescribe"}},[r("el-input",{attrs:{type:"textarea",maxlength:"128","show-word-limit":"",rows:8},model:{value:e.addForm.strategyDescribe,callback:function(t){e.$set(e.addForm,"strategyDescribe","string"===typeof t?t.trim():t)},expression:"addForm.strategyDescribe"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addFormDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick",value:1e3,expression:"1000"}],attrs:{type:"primary"},on:{click:e.addEnsure}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"添加操作",visible:e.actionDialogVisible,width:"600px"},on:{"update:visible":function(t){e.actionDialogVisible=t},close:e.actionDialogClosed}},[r("el-form",{ref:"actionFormRef",attrs:{model:e.actionForm,rules:e.actionFormRules,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"选择操作:",prop:"checkedAuth"}},[r("div",{staticClass:"block"},[r("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.options,props:e.prop,"show-all-levels":!1,clearable:""},model:{value:e.actionForm.checkedAuth,callback:function(t){e.$set(e.actionForm,"checkedAuth",t)},expression:"actionForm.checkedAuth"}})],1)])],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.actionDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick",value:1e3,expression:"1000"}],attrs:{type:"primary"},on:{click:e.submitAction}},[e._v("确 定")])],1)],1)],1)},n=[],s=(r("99af"),r("4160"),r("d81d"),r("159b"),r("96cf"),r("1da1")),i={data:function(){return{getRowKeys:function(e){return e.strategyId},expands:[],userList:[],queryInfo:{pagenum:1,pagesize:10},total:0,title:"",editId:null,addFormDialogVisible:!1,addForm:{strategyName:"",strategyDescribe:""},addFormRules:{strategyName:[{required:!0,message:"必填项不能为空",trigger:"blur"},{min:1,max:32,message:"长度不能超过32个字符",trigger:"blur"}],strategyDescribe:[{min:0,max:128,message:"长度不能超过128个字符",trigger:"blur"}]},actionStrategyId:"",actionDialogVisible:!1,checkactionCode:[],actionForm:{checkedAuth:[]},actionFormRules:{},options:[],prop:{multiple:!0,emitPath:!1,value:"apiId",label:"apiName",children:"apiResources"}}},beforeRouteEnter:function(e,t,r){var a=window.sessionStorage.getItem("accountTypeLogin");if("9"!==a)return r("/404");r()},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("strategy/getStrategy/".concat(e.queryInfo.pagenum,"/").concat(e.queryInfo.pagesize,"?ts=").concat((new Date).getTime()));case 2:if(r=t.sent,a=r.data,0===a.code){t.next=6;break}return t.abrupt("return",e.$message.error("获取策略信息失败！"));case 6:a.data.list.map((function(e){e.ruleItemData=[]})),e.userList=a.data.list,e.total=a.data.total;case 9:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange:function(e){this.queryInfo.pagenum=e,this.getUserList()},expandChange:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r.expands=[],t.length>0&&(e&&r.expands.push(e.strategyId),r.getAuthority(e.strategyId));case 2:case"end":return a.stop()}}),a)})))()},getAuthority:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.get("strategy/getActionInfo?strategyId=".concat(e,"&ts=").concat((new Date).getTime()));case 2:if(a=r.sent,n=a.data,0===n.code){r.next=6;break}return r.abrupt("return",t.$message.error(""!==n.msg&&null!==n.msg?n.msg:"获取操作失败！"));case 6:t.userList.forEach((function(r,a){r.strategyId===e&&(t.userList[a].ruleItemData=n.data)}));case 7:case"end":return r.stop()}}),r)})))()},removeRightById:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.$confirm("此操作将删除该操作, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(n=a.sent,"confirm"===n){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,r.$http.post("strategy/deleteAction?strategyActionId=".concat(t));case 7:if(s=a.sent,i=s.data,0===i.code){a.next=11;break}return a.abrupt("return",r.$message.error(null!==i.msg&&""!==i.msg?i.msg:"删除操作失败！"));case 11:r.$message.success("删除操作成功！"),r.getAuthority(e.strategyId);case 13:case"end":return a.stop()}}),a)})))()},deleteById:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("此操作将删除该策略，是否继续？","提示",{confimrButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(a=r.sent,"confirm"===a){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t.$http.post("strategy/deleteStrategy?strategyId=".concat(e));case 7:if(n=r.sent,s=n.data,0===s.code){r.next=11;break}return r.abrupt("return",t.$message.error(""!==s.msg&&null!==s.msg?s.msg:"删除策略失败！"));case 11:t.$message.success("删除策略成功！"),t.getUserList();case 13:case"end":return r.stop()}}),r)})))()},openAdd:function(){this.title="添加策略",this.addFormDialogVisible=!0},addDialogClosed:function(){this.$refs.addFormRef.resetFields()},addEnsure:function(){var e=this;this.$refs.addFormRef.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:return"添加策略"===e.title?(a={strategyName:e.addForm.strategyName,strategyDescribe:e.addForm.strategyDescribe},n="strategy/addStrategy"):(a={strategyName:e.addForm.strategyName,strategyDescribe:e.addForm.strategyDescribe,strategyId:e.editId},n="strategy/updateStrategy"),s="添加策略"===e.title?"添加":"编辑",t.next=6,e.$http.post(n,a);case 6:if(i=t.sent,o=i.data,0===o.code){t.next=10;break}return t.abrupt("return",e.$message.error(null!==o.msg&&""!==o.msg?o.msg:s+"失败！"));case 10:e.$message.success(s+"成功！"),e.addFormDialogVisible=!1,e.getUserList();case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},editById:function(e){this.editId=e.strategyId,this.addForm.strategyName=e.strategyName,this.addForm.strategyDescribe=e.strategyDescribe,this.title="编辑策略",this.addFormDialogVisible=!0},openAction:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.actionStrategyId=e.strategyId,r.next=3,t.$http.get("strategy/getActionInfo?strategyId=".concat(e.strategyId,"&ts=").concat((new Date).getTime()));case 3:if(a=r.sent,n=a.data,0===n.code){r.next=7;break}return r.abrupt("return",t.$message.error(""!==n.msg&&null!==n.msg?n.msg:"获取操作失败！"));case 7:if(s=n.data,s.length>0){for(i=0;i<s.length;i++)t.checkactionCode.push(s[i].apiId);t.actionForm.checkedAuth=[].concat(t.checkactionCode)}t.actionDialogVisible=!0,t.getCategory();case 11:case"end":return r.stop()}}),r)})))()},actionDialogClosed:function(){this.$refs.actionFormRef.clearValidate(),this.actionForm.checkedAuth=[],this.checkactionCode=[]},submitAction:function(){var e=this;if(this.actionForm.checkedAuth.length<1)return this.$message.error("请选择操作！");this.$refs.actionFormRef.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:return a={apiId:e.actionForm.checkedAuth,strategyId:e.actionStrategyId},t.next=5,e.$http.post("strategy/addAction",a);case 5:if(n=t.sent,s=n.data,0===s.code){t.next=9;break}return t.abrupt("return",e.$message.error(null!==s.msg&&""!==s.msg?s.msg:"添加操作失败！"));case 9:e.$message.success("添加操作成功！"),e.actionDialogVisible=!1,e.getAuthority(e.actionStrategyId);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getCategory:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("resource/getResource");case 2:if(r=t.sent,a=r.data,0===a.code){t.next=6;break}return t.abrupt("return",e.$message.error("获取操作信息失败！"));case 6:e.options=a.data;case 7:case"end":return t.stop()}}),t)})))()}}},o=i,c=(r("5e66"),r("2877")),u=Object(c["a"])(o,a,n,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-684fdd58.78a12222.js.map
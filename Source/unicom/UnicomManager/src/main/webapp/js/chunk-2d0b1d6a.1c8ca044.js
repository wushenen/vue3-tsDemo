(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b1d6a"],{"220d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"min-width":"1200px"}},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),r("el-breadcrumb-item",{attrs:{to:{path:"/secrets"}}},[e._v("凭据管理")]),r("el-breadcrumb-item",[e._v("凭据版本")])],1),r("el-card",[r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("添加")])],1),r("el-table",{attrs:{data:e.keyList,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index",label:"序号"}}),r("el-table-column",{attrs:{label:"凭据名称","show-overflow-tooltip":!0}},[e._v(e._s(e.secretName))]),r("el-table-column",{attrs:{label:"版本标识符",prop:"versionId"}}),r("el-table-column",{attrs:{label:"创建时间",prop:"createTime","show-overflow-tooltip":!0}}),r("el-table-column",{attrs:{label:"计划删除时间",prop:"plannedDeleteTime","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(null===t.row.plannedDeleteTime||""===t.row.plannedDeleteTime?"-":t.row.plannedDeleteTime))])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(r){return e.open(t.row.versionId)}}},[e._v("获取凭据值 ")]),r("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(r){return e.deleteByName(t.row.versionId)}}},[e._v("删除 ")]),null!=t.row.plannedDeleteTime?r("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(r){return e.deleCancel(t.row.versionId)}}},[e._v("恢复凭据 ")]):e._e()]}}])})],1),r("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[5,10,15,20],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:"获取指定版本的凭据值",visible:e.pingDialogVisible,width:"500px"},on:{"update:visible":function(t){e.pingDialogVisible=t},close:e.pingDialogClosed}},[r("p",[r("span",[e._v("凭据值：")]),r("span",[e._v(e._s(e.gridData.secretData))])]),r("p",[r("span",[e._v("凭据类型：")]),r("span",[e._v(e._s(e.gridData.secretDataType))])])]),r("el-dialog",{attrs:{title:"为凭据存入一个新版本的凭据值",visible:e.addDialogVisible,width:"500px"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.addDialogClosed}},[r("el-form",{ref:"addFormRef",staticStyle:{width:"80%",margin:"20px auto"},attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"凭据名称",prop:"secretName"}},[r("el-input",{attrs:{disabled:""},model:{value:e.addForm.secretName,callback:function(t){e.$set(e.addForm,"secretName","string"===typeof t?t.trim():t)},expression:"addForm.secretName"}})],1),r("el-form-item",{attrs:{label:"凭据值",prop:"secretData"}},[r("el-input",{model:{value:e.addForm.secretData,callback:function(t){e.$set(e.addForm,"secretData","string"===typeof t?t.trim():t)},expression:"addForm.secretData"}})],1),r("el-form-item",{attrs:{label:"版本号",prop:"versionId"}},[r("el-input",{model:{value:e.addForm.versionId,callback:function(t){e.$set(e.addForm,"versionId","string"===typeof t?t.trim():t)},expression:"addForm.versionId"}})],1),r("el-form-item",{attrs:{label:"凭据值类型",prop:"secretDataType"}},[r("el-radio-group",{model:{value:e.addForm.secretDataType,callback:function(t){e.$set(e.addForm,"secretDataType",t)},expression:"addForm.secretDataType"}},[r("el-radio",{attrs:{label:"text"}},[e._v("text")]),r("el-radio",{attrs:{label:"binary"}},[e._v("binary")])],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submitAdd}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"删除指定版本的凭据对象",visible:e.deleDialogVisible,width:"500px"},on:{"update:visible":function(t){e.deleDialogVisible=t},close:e.deleDialogClosed}},[r("el-form",{ref:"deleFormRef",staticStyle:{width:"80%",margin:"20px auto"},attrs:{model:e.deleForm,rules:e.deleFormRules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"是否强制删除",prop:"type"}},[r("el-radio-group",{on:{change:e.radioChange},model:{value:e.deleForm.type,callback:function(t){e.$set(e.deleForm,"type",t)},expression:"deleForm.type"}},[r("el-radio",{attrs:{label:"false"}},[e._v("否")]),r("el-radio",{attrs:{label:"true"}},[e._v("是")])],1)],1),e.isdeleShow?r("el-form-item",{attrs:{label:"预删除天数",prop:"days"}},[r("el-input",{model:{value:e.deleForm.days,callback:function(t){e.$set(e.deleForm,"days","string"===typeof t?t.trim():t)},expression:"deleForm.days"}})],1):e._e()],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.deleDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submitDele}},[e._v("确 定")])],1)],1)],1)],1)},n=[],s=(r("96cf"),r("1da1")),i={data:function(){var e=function(e,t,r){var a=/^[0-9]*[1-9][0-9]*$/;if(a.test(t)){if(t>0&&t<31)return r();r(new Error("请输入1-30的数字"))}r(new Error("请输入1-30的数字"))};return{queryInfo:{pagenum:1,pagesize:10},keyList:[],total:0,secretName:this.$route.query.secretName,gridData:{},pingDialogVisible:!1,pingForm:{versionId:""},addDialogVisible:!1,addForm:{secretData:"",secretName:this.$route.query.secretName,versionId:"",secretDataType:"text"},addFormRules:{secretData:[{required:!0,message:"必填项不能为空",trigger:"blur"}],secretName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],versionId:[{required:!0,message:"必填项不能为空",trigger:"blur"}]},isdeleShow:!0,deleDialogVisible:!1,versionIdDele:"",deleForm:{type:"false",days:"30"},deleFormRules:{days:[{required:!0,validator:e,trigger:"blur"}]}}},beforeRouteEnter:function(e,t,r){var a=window.sessionStorage.getItem("accountTypeLogin");if("9"!==a)return r("/404");r()},created:function(){this.getKeyId()},methods:{getKeyId:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("v1/kms/ListSecretVersionIds",{secretName:e.secretName,pageNumber:e.queryInfo.pagenum,pageSize:e.queryInfo.pagesize});case 2:if(r=t.sent,a=r.data,0!==a.code){t.next=9;break}e.keyList=a.data.versionIds,e.total=a.data.totalCount,t.next=10;break;case 9:return t.abrupt("return",e.$message.error("获取密钥版本信息失败！"));case 10:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.queryInfo.pagesize=e,this.getKeyId()},handleCurrentChange:function(e){this.queryInfo.pagenum=e,this.getKeyId()},open:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.post("v1/kms/GetSecretValue",{secretName:t.secretName,versionId:e});case 2:if(a=r.sent,n=a.data,0===n.code){r.next=6;break}return r.abrupt("return",t.$message.error(""!==n.msg&&null!==n.msg?n.msg:"请求失败！"));case 6:t.gridData=n.data,t.pingDialogVisible=!0;case 8:case"end":return r.stop()}}),r)})))()},pingDialogClosed:function(){},addDialogClosed:function(){this.$refs.addFormRef.resetFields()},submitAdd:function(){var e=this;this.$refs.addFormRef.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$http.post("v1/kms/PutSecretValue",e.addForm);case 4:if(a=t.sent,n=a.data,0===n.code){t.next=8;break}return t.abrupt("return",e.$message.error(""!==n.msg&&null!==n.msg?n.msg:"添加失败！"));case 8:e.$message.success("添加成功！"),e.addDialogVisible=!1,e.getKeyId();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},deleCancel:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("确定要恢复被删除的凭据？","提示",{confirmButtonText:"确定",cancelButtontext:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(a=r.sent,"confirm"===a){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t.$http.post("v1/kms/RestoreSecret",{secretName:t.secretName,versionId:e});case 7:if(n=r.sent,s=n.data,0===s.code){r.next=11;break}return r.abrupt("return",t.$message.error(""!==s.msg&&null!==s.msg?s.msg:"恢复失败！"));case 11:t.$message.success("恢复成功！"),t.getKeyId();case 13:case"end":return r.stop()}}),r)})))()},deleteByName:function(e){this.deleDialogVisible=!0,this.versionIdDele=e,this.isdeleShow=!0,this.deleForm.days="30"},submitDele:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.deleFormRef.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$http.post("v1/kms/DeleteSecret",{versionId:e.versionIdDele,secretName:e.secretName,forceDeleteWithoutRecovery:e.deleForm.type,recoveryWindowInDays:e.deleForm.days});case 4:if(a=t.sent,n=a.data,0===n.code){t.next=8;break}return t.abrupt("return",e.$message.error(""!==n.msg&&null!==n.msg?n.msg:"删除失败！"));case 8:e.$message.success("删除成功！"),e.deleDialogVisible=!1,e.getKeyId();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},radioChange:function(e){"true"===e?(this.deleForm.days="",this.isdeleShow=!1):(this.isdeleShow=!0,this.deleForm.days="30")},deleDialogClosed:function(){this.$refs.deleFormRef.resetFields()}}},o=i,l=r("2877"),d=Object(l["a"])(o,a,n,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-2d0b1d6a.1c8ca044.js.map
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qtec.unicom.mapper.DeviceStatusMapper">

    <!--添加终端状态信息-->
    <insert id="addDeviceStatusInfo" parameterType="com.qtec.unicom.pojo.DeviceStatus">
        insert into t_device_status (device_name,device_ip,work_status,online_time,key_num,enc_data,dec_data,enc_rate,dec_rate)
        values (#{deviceName},#{deviceIp},#{workStatus},#{onlineTime},#{keyNum},#{encData},#{decData},#{encRate},#{decRate})
    </insert>

    <!--判断是否已经添加-->
    <select id="deviceStatusInfoExist" resultType="boolean">
        select count(1)
        from t_device_status
        where device_name = #{deviceName}
    </select>

    <!--修改密钥云终端信息-->
    <update id="updateDeviceStatusInfo" parameterType="com.qtec.unicom.pojo.DeviceStatus">
        update t_device_status
        set
            work_status = #{workStatus},
            online_time = #{onlineTime},
            device_ip = #{deviceIp},
            key_num = #{keyNum},
            enc_data = #{encData},
            dec_data = #{decData},
            enc_rate = #{encRate},
            dec_rate = #{decRate},
            update_time = now()
        where device_name = #{deviceName}
    </update>

    <!--查看密钥云终端信息-->
    <select id="listDeviceStatusInfo" resultType="com.qtec.unicom.pojo.DeviceStatus">
        select * from t_device_status
        order by create_time desc
    </select>

    <select id="getDeviceStatusInfoByDeviceName" resultType="com.qtec.unicom.pojo.DeviceStatus">
        select * from t_device_status
        where device_name = #{deviceName}
    </select>


    <!--密码态势感知数据-->
    <select id="getDeviceStatusInfo" resultType="com.qtec.unicom.pojo.DTO.DeviceStatusDataInfo">
        SELECT COUNT(1) as deviceNum,
        SUM(work_status) as onlineNum,
        SUM(key_num) as keyNum,
        SUM(enc_data) as encDataNum,
        SUM(dec_data) as decDataNum
        FROM t_device_status
    </select>

    <select id="getDeviceStatusInfo2" resultType="com.qtec.unicom.pojo.DTO.DeviceStatusDataInfo">
        SELECT COUNT(1) as deviceNum,
        SUM(work_status) as onlineNum,
        SUM(key_num) as keyNum,
        SUM(enc_data) as encDataNum,
        SUM(dec_data) as decDataNum
        FROM t_device_status
        where create_time
        between DATE_SUB(CURRENT_TIME,INTERVAL 5 day) and CURRENT_DATE
    </select>

    <select id="keyGenNum" resultType="Long">
        SELECT COUNT(1)
        FROM t_key_info
    </select>

    <select id="keyGenNum2" resultType="Long">
        SELECT COUNT(1)
        FROM t_key_info
        where update_time
        between DATE_SUB(CURRENT_TIME,INTERVAL 5 day) and CURRENT_DATE
    </select>

    <select id="everyDayKeyInfo" resultType="com.qtec.unicom.pojo.DTO.DeviceKeyInfo">
        SELECT DATE_FORMAT(create_time,'%Y-%m-%d') as timeInfo , count(1) as keyNum from t_key_info
        WHERE create_time BETWEEN DATE_SUB(current_date ,INTERVAL 5 day) and CURRENT_DATE
        GROUP BY timeInfo
        ORDER BY timeInfo desc
        LIMIT 5
    </select>

    <select id="nearlyDayKeyNum" resultType="Long">
        select count(1) from t_key_info
        where create_time between date_sub(current_time , interval 24 hour) and current_time
    </select>

    <select id="offlineKeyNum" resultType="Long">
        SELECT COUNT(1)
        FROM t_key_offline
    </select>

</mapper>